<!DOCTYPE html>
<html lang="en">
<body>

<head>
    <title>Usage</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A light microservice stack.">
    <meta name="author" content="Yupiik Minisite Generator">
    <meta name="generator" content="Yupiik Minisite Generator">
    <meta name="keywords" content="Uship, microservice, development">

    <link rel="shortcut icon" href="//www.yupiik.com/img/favicon.png">

    <link href="//fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,700,700i|Montserrat:300,400,500,700" rel="stylesheet">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" crossorigin="anonymous" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/asciidoctor.js/1.5.5-5/css/asciidoctor.min.css" integrity="sha512-kI7tn5cuEg16kMeXnYmg8rEJPxbxzEM7Gsr191iQdLDevFBLXPCSU9aZWSVuP61tMZWU3nBAR1cJ7SmXnOGLZw==" crossorigin="anonymous" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.3/css/bootstrap.min.css" integrity="sha512-oc9+XSs1H243/FRN9Rw62Fn8EtxjEYWHXRvjS43YtueEewbS6ObfXcJNyohjHqVKFPoXXUxwc+q1K7Dee6vv9g==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.1/styles/vs2015.min.css" integrity="sha512-w8aclkBlN3Ha08SMwFKXFJqhSUx2qlvTBFLLelF8sm4xQnlg64qmGB/A6pBIKy0W8Bo51yDMDtQiPLNRq1WMcQ==" crossorigin="anonymous" />
    <link id="theme-style" rel="stylesheet" href="//yupiik.github.io/uship/css/theme.css?v=1.0.5-SNAPSHOT">
    
</head>
    <header class="header fixed-top">
        <div class="branding docs-branding">
            <div class="container-fluid position-relative py-2">
                <div class="docs-logo-wrapper">
	                <div class="site-logo"><a title="Home" class="navbar-brand" href="//yupiik.github.io/uship/index.html">
	                <img class="logo-icon mr-2" src="//www.yupiik.com/img/favicon.png" alt="logo">
	                <span class="logo-text">Yupiik µShip <span class="text-alt">Docs</span></span></a></div>
                </div>
	            <div class="docs-top-utilities d-flex justify-content-end align-items-center">
					
					<li class="list-inline-item"><a title="Search" id="search-button" href="#" data-toggle="modal" data-target="#searchModal"><i data-toggle="tooltip" data-placement="top" title="Search" class="fas fa-search"></i></a></li>

					<ul class="social-list list-inline mx-md-3 mx-lg-5 mb-0 d-none d-lg-flex">
						
						<li class="list-inline-item"><a href="https://www.github.com/yupiik/"><i class="fab fa-github fa-fw"></i></a></li><li class="list-inline-item"><a href="https://www.linkedin.com/company/yupiik/"><i class="fab fa-linkedin fa-fw"></i></a></li>
		            </ul>
	            </div>
            </div>
        </div>
    </header>
	<div class="page">
        <div class="page-navigation-left">
            <h3>Menu</h3>
            <ul>
                <li>
                    <a title="Getting Started" href="//yupiik.github.io/uship/getting-started.html">
                        <i class="fas fa-play"></i>Getting Started
                    </a>
                </li>                <li>
                    <a title="Uship Usage" href="//yupiik.github.io/uship/development-stack.html">
                        <i class="fas fa-code"></i>Usage
                    </a>
                </li>                <li>
                    <a title="Uship Testing" href="//yupiik.github.io/uship/testing.html">
                        <i class="fas fa-vial"></i>Testing
                    </a>
                </li>                <li>
                    <a title="Uship Packaging" href="//yupiik.github.io/uship/packaging.html">
                        <i class="fas fa-file-archive"></i>Packaging
                    </a>
                </li>
            </ul>
        </div>

        <div id="development-stack-html-container" class="container page-content development-stack-html">
                        <div class="page-header">
                <h1>Uship Usage</h1>
            </div>
            <div class="page-content-body">
                <div class="sect1">
<h2 id="_setup_your_json_rpc_service_with_µship_stack">Setup your JSON-RPC service with µship stack</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To get started, you have to create a new project.
This part will use Maven to illustrate the process but it is easily adaptable to Gradle or any Java based project.</p>
</div>
<div class="paragraph">
<p>To create a new Apache Maven project, you can use <code>mvn archetype:generate</code> but we recommend you to just create a folder and manually write a pom to avoid to inherit from a legacy setup.</p>
</div>
<div class="paragraph">
<p>Here is a <code>pom.xml</code> template you can use to get started:</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

  <b class="conum">(1)</b>
  &lt;groupId&gt;com.company&lt;/groupId&gt;
  &lt;artifactId&gt;my-app&lt;/artifactId&gt;
  &lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;

  &lt;properties&gt;
    &lt;maven.compiler.java.version&gt;11&lt;/maven.compiler.java.version&gt;

    &lt;uship.version&gt;...&lt;/uship.version&gt; <b class="conum">(2)</b>
  &lt;/properties&gt;

  &lt;dependencies&gt;
    &lt;dependency&gt; <b class="conum">(3)</b>
      &lt;groupId&gt;io.yupiik.logging&lt;/groupId&gt;
      &lt;artifactId&gt;yupiik-logging-jul&lt;/artifactId&gt;
      &lt;version&gt;1.0.0&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt; <b class="conum">(4)</b>
      &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;
      &lt;artifactId&gt;junit-jupiter&lt;/artifactId&gt;
      &lt;version&gt;5.8.0-M1&lt;/version&gt;
      &lt;scope&gt;test&lt;/scope&gt;
      &lt;exclusions&gt;
        &lt;exclusion&gt; <b class="conum">(5)</b>
          &lt;groupId&gt;org.jetbrains.kotlin&lt;/groupId&gt;
          &lt;artifactId&gt;*&lt;/artifactId&gt;
        &lt;/exclusion&gt;
      &lt;/exclusions&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;

  &lt;dependencyManagement&gt;
    &lt;dependencies&gt;
      &lt;dependency&gt; <b class="conum">(6)</b>
        &lt;groupId&gt;io.yupiik.uship&lt;/groupId&gt;
        &lt;artifactId&gt;bom&lt;/artifactId&gt;
        &lt;version&gt;${uship.version}&lt;/version&gt;
      &lt;/dependency&gt;
    &lt;/dependencies&gt;
  &lt;/dependencyManagement&gt;

  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt; <b class="conum">(7)</b>
        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;maven-resources-plugin&lt;/artifactId&gt;
        &lt;version&gt;3.2.0&lt;/version&gt;
        &lt;configuration&gt;
          &lt;encoding&gt;UTF-8&lt;/encoding&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;
      &lt;plugin&gt; <b class="conum">(8)</b>
        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
        &lt;version&gt;3.8.1&lt;/version&gt;
        &lt;configuration&gt;
          &lt;source&gt;${maven.compiler.java.version}&lt;/source&gt;
          &lt;target&gt;${maven.compiler.java.version}&lt;/target&gt;
          &lt;release&gt;${maven.compiler.java.version}&lt;/release&gt;
          &lt;encoding&gt;UTF-8&lt;/encoding&gt;
          &lt;parameters&gt;true&lt;/parameters&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;
      &lt;plugin&gt; <b class="conum">(9)</b>
        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;
        &lt;version&gt;3.0.0-M5&lt;/version&gt;
        &lt;configuration&gt;
          &lt;trimStackTrace&gt;false&lt;/trimStackTrace&gt; <b class="conum">(10)</b>
          &lt;systemPropertyVariables&gt; <b class="conum">(11)</b>
            &lt;java.util.logging.manager&gt;io.yupiik.logging.jul.YupiikLogManager&lt;/java.util.logging.manager&gt;
          &lt;/systemPropertyVariables&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;
&lt;/project&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Ensure to define your project metadata, note that this setup will be compatible with a multi-module project too,</p>
</li>
<li>
<p>Define uship version as a variable for easier upgrades (not required),</p>
</li>
<li>
<p>We use Yupiik Logging to get a more cloud friendly logging but this is not required at all, skip this dependency if not desired (if you prefer Log4j2 or so use JUL binding for example),</p>
</li>
<li>
<p>We want to write tests with JUnit 5 so we set it as dependency,</p>
</li>
<li>
<p>JUnit 5.8.0-M1 got a pom bug so we force kotlin exclusion to workaround it,</p>
</li>
<li>
<p>We import the UShip bom to get dependencies versions right,</p>
</li>
<li>
<p>We force the encoding for resources to avoid surprises (OS dependent otherwise),</p>
</li>
<li>
<p>We force the compiler to use the Java version we want (note you can use any version &gt;= 11),</p>
</li>
<li>
<p>We force surefire version to ensure we are JUnit 5 compatible,</p>
</li>
<li>
<p>We prevent surefire to trim the stack when an exception is thrown - it swallows the information you need to understand why it failed in general,</p>
</li>
<li>
<p>We force Yupiik logging manager (if you don&#8217;t use Yupiik Logging, skip it).</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
µship does <strong>not</strong> use a parent pom to set it up automatically because:
1. it can quickly get outdated with transitive dependencies and project must be able to update any of the plugin/dependencies without a new µship release for flexibility,
2. you can use other plugins (<code>junit-platform-maven-plugin</code> instead of <code>maven-surefire-plugin</code> for example, spock, etc&#8230;&#8203;),
3. it is saner to use a project related parent than a cross-project parent which is a bad practise and breaks several Maven features/integrations.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>At that stage we have a good "parent" pom but to be able to code against it you should add the related dependencies.
The simplest is to add this dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;dependency&gt;
  &lt;groupId&gt;io.yupiik.uship&lt;/groupId&gt;
  &lt;artifactId&gt;jsonrpc-core&lt;/artifactId&gt;
  &lt;version&gt;${uship.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>From here you can develop JSON-RPC endpoints.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_create_json_rpc_endpoints">Create JSON-RPC endpoints</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Creating a JSON-RPC endpoint is about marking a bean with the qualifier <code>@JsonRpc</code> and some method(s) with <code>@JsonRpcMethod</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@JsonRpc <b class="conum">(1)</b>
@ApplicationScoped <b class="conum">(2)</b>
public class MyEndpoints {
    @JsonRpcMethod(name = "test1") <b class="conum">(3)</b>
    public Foo test1(@JsonRpcParam final String in) { <b class="conum">(4)</b>
        // ...
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Defines the class as containing JSON-RPC methods,</p>
</li>
<li>
<p>Since the class will match a CDI bean, it can use any relevant scope. We strongly encourage you to use <code>@ApplicationScoped</code> if possible for performances and consistency but it is not required,</p>
</li>
<li>
<p><code>@JsonRpcMethod</code> defines a method usable over JSON-RPC transport (a servlet by default). The <code>name</code> attribute must be unique per deployment and we highly recommend you to set the <code>documentation</code> attribute,</p>
</li>
<li>
<p>The method can then define its return type and inputs as any JSON-B friendly types. Inputs can be marked with <code>@JsonRpcParam</code> to set their <code>documentation</code>.</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
the JSON-RPC implementation supports by position calls (parameters are passed in order) or names (<code>JsonRpcParam#value</code>). If not explicitly set, the name is taken from the parameter bytecode name. It is highly recommended to set <code>-parameters</code> to <code>javac</code> to get the same names than in the source code. Also take care that the order and names are then part of your contract.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_document_json_rpc_endpoints">Document JSON-RPC endpoints</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If fully described - <code>documentation</code> methods being set in annotations, you can generate your endpoint documentation using <code>jsonrpc-documentation</code> module and in particular <code>io.yupiik.uship.jsonrpc.doc.AsciidoctorJsonRpcDocumentationGenerator</code> class.</p>
</div>
<div class="paragraph">
<p>You have to add this dependency to your pom.xml:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;dependency&gt;
    &lt;groupId&gt;io.yupiik.uship&lt;/groupId&gt;
    &lt;artifactId&gt;jsonrpc-documentation&lt;/artifactId&gt;
    &lt;version&gt;${uship.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then add new exec build plugin instructions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;plugin&gt;
  &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
    &lt;artifactId&gt;exec-maven-plugin&lt;/artifactId&gt;
    &lt;version&gt;...&lt;/version&gt;
    &lt;executions&gt;
      &lt;execution&gt; <b class="conum">(1)</b>
        &lt;id&gt;api-asciidoc&lt;/id&gt;
        &lt;phase&gt;process-classes&lt;/phase&gt;
        &lt;goals&gt;
            &lt;goal&gt;java&lt;/goal&gt;
        &lt;/goals&gt;
        &lt;configuration&gt;
            &lt;mainClass&gt;io.yupiik.uship.jsonrpc.doc.AsciidoctorJsonRpcDocumentationGenerator&lt;/mainClass&gt;
            &lt;includeProjectDependencies&gt;true&lt;/includeProjectDependencies&gt;
            &lt;arguments&gt;
                &lt;argument&gt;My JSON-RPC API&lt;/argument&gt; &lt;!-- document title --&gt;
                &lt;argument&gt;com.company.MyEndpoints1,com.company.MyEndpoints2,...&lt;/argument&gt; &lt;!-- classes --&gt;
                &lt;argument&gt;${project.build.directory}/generated-doc/api.adoc&lt;/argument&gt; &lt;!-- output --&gt;
            &lt;/arguments&gt;
        &lt;/configuration&gt;
      &lt;/execution&gt;
      &lt;execution&gt; <b class="conum">(2)</b>
        &lt;id&gt;api-openrpc.json&lt;/id&gt;
        &lt;phase&gt;process-classes&lt;/phase&gt;
        &lt;goals&gt;
            &lt;goal&gt;java&lt;/goal&gt;
        &lt;/goals&gt;
        &lt;configuration&gt;
            &lt;mainClass&gt;io.yupiik.uship.jsonrpc.doc.OpenRPCGenerator&lt;/mainClass&gt;
            &lt;includeProjectDependencies&gt;true&lt;/includeProjectDependencies&gt;
            &lt;arguments&gt;
                &lt;argument&gt;My JSON-RPC API&lt;/argument&gt; &lt;!-- OpenRPC title --&gt;
                &lt;argument&gt;com.company.MyEndpoints1,com.company.MyEndpoints2,...&lt;/argument&gt; &lt;!-- classes to use --&gt;
                &lt;argument&gt;${project.build.directory}/generated-doc/openrpc.json&lt;/argument&gt; &lt;!-- output --&gt;
                &lt;argument&gt;https://api.company.com/jsonrpc&lt;/argument&gt; &lt;!-- base --&gt;
                &lt;argument&gt;true&lt;/argument&gt; &lt;!-- formatted --&gt;
            &lt;/arguments&gt;
        &lt;/configuration&gt;
      &lt;/execution&gt;
    &lt;/executions&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Will generate a textual (Asciidoctor) documentation of your contract from the classes listed in the arguments,</p>
</li>
<li>
<p>Will generate an OpenRPC (JSON) contract from the classes listed in the arguments.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_optimize_your_json_rpc_execution">Optimize your JSON-RPC execution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As with any bulk friendly solution, you can optimize the JSON-RPC execution by implementing a kind of "execution plan" for the request.
There are several cases it can be useful:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>You receive a bulk request (array) which does N &gt; 1 atomic findById and want to replace it by a single <code>findByIds</code>,</p>
</li>
<li>
<p>You have a custom bulk method,</p>
</li>
<li>
<p>You have a bulk request which can be optimized merging multiple requests (in this case the result of the first one can be dropped and only the last one will be used for ex.).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Let&#8217;s take a concrete example:</p>
</div>
<div class="paragraph">
<p>You receive:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="json" class="language-json hljs">[
  {"jsonrpc":"2.0","method":"entityfindById","params":{"id":"1"}},
  {"jsonrpc":"2.0","method":"entityfindById","params":{"id":"2"}}
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you keep it this way you will do 2 queries (assume SQL ones for example).
The idea is to replace them by an alternative execution which would do a single query.</p>
</div>
<div class="paragraph">
<p>One option, if you already have a method enabling that is to replace the method and then dispatch the results:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="json" class="language-json hljs">[
  {"jsonrpc":"2.0","method":"entityfindByIds","params":{"ids":["1","2"]}}
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>This can be done rewritting the request this way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Specializes
@ApplicationScoped
public class EnrichedJsonRpcHandler extends JsonRpcHandler {
    @Inject
    private RequestRewriter requestRewriter; // your own impl

    @Override
    public JsonStructure readRequest(final HttpServletRequest request, final Reader reader) throws IOException {
        return requestRewriter.rewrite(request::setAttribute, super.readRequest(reader));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The issue then is to dispatch the result since instead of having 2 <code>findById</code> results you get a single one <code>findByIds</code>.
The trick there is to pass a state in the <code>HttpServletRequest</code> as attribute and use it in <code>handleRequest</code> to be able to process the output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Specializes
@ApplicationScoped
public class EnrichedJsonRpcHandler extends JsonRpcHandler {
    @Inject
    private RequestRewriter requestRewriter;

    @Override
    public JsonStructure readRequest(final HttpServletRequest request, final Reader reader) throws IOException {
        return requestRewriter.preProcess(request::setAttribute, super.readRequest(reader)); <b class="conum">(1)</b>
    }

    @Override
    public CompletionStage&lt;Response&gt; handleRequest(final JsonObject request,
                                                   final HttpServletRequest httpRequest,
                                                   final HttpServletResponse httpResponse) {
        return super.handleRequest(request, httpRequest, httpResponse)
                .thenApply(res -&gt; requestRewriter.postProcess(httpRequest::getAttribute, res)); <b class="conum">(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>We rewrite the request before its execution,</p>
</li>
<li>
<p>We process the response after its execution (take care to error cases).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>As a guide, here is a skeleton for the request rewritter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@ApplicationScoped
public class RequestRewriter {
    public JsonStructure preProcess(final BiConsumer&lt;String, Object&gt; attributeSetter, final JsonStructure structure) {
        if (isFindByIds(structure)) { // if it a rewritten request
            // store the post process callback - enables to have a generic postProcess
            attributeSetter.accept("RequestRewriter.postProcess", (Function&lt;Response, Response&gt;) this::dispatchFindByIds);
            // rewrite the request
            return flattenFindByIds(structure);
        }
        return structure;
    }

    public Response postProcess(final Function&lt;String, Object&gt; attributeGetter, final Response result) {
        return ofNullable(attributeGetter.apply("RequestRewriter.postProcess"))
                .map(it -&gt;  (Function&lt;Response, Response&gt;) it)
                .map(it -&gt; it.apply(result))
                .orElse(result);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>An alternative is to just override <code>handleRequest</code> to implement there the alternative execution paths:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Specializes
@ApplicationScoped
public class EnrichedJsonRpcHandler extends JsonRpcHandler {
    @Override
    public CompletionStage&lt;?&gt; execute(final JsonStructure request, final HttpServletRequest httpRequest, final HttpServletResponse httpResponse) {
        if (shouldBeRewritten(request)) { // to define with your rules
            return alternativeImplementation(request);
        }
        return super.execute(request, httpRequest, httpResponse);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want a more complete example of execution plan you can read <a href="jsonrpc-execution-plan.html">execution plan example</a> page.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_postman_collection_for_json_rpc_endpoint">Postman collection for JSON-RPC endpoint</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Similarly to Asciidoctor documentation you can generate a collection of JSON-RPC requests using <code>PostmanCollectionGenerator</code> main.
It takes an OpenRPC file (you can get it with <code>openrpc</code> method) and output a Postman collection file.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_persistence">Persistence</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Since UShip is mainly CDI based, it will be compatible with any kind of persistence Layer from SQL to NoSQL.
However, for common simple cases, we ship a small JDBC mapper in our <code>io.yupiik.uship:persistence</code> module.</p>
</div>
<div class="paragraph">
<p>Its scope is not to replace JPA but for simple cases to just provide a very light ORB.
It only supports flat mapping - relationships must be managed by your which also means no magic or lazy query ;) - and transactions are managed through the <code>DataSource</code>.
It works if the <code>Connection</code> is in autocommit mode or if you handle the commit through a transactional interceptor for example.</p>
</div>
<div class="paragraph">
<p>The entry point is the <code>Database.of(configuration)</code> factory then all operations are available on the <code>database</code> instance.</p>
</div>
<div class="paragraph">
<p>Here some examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">final var database = Database.of(new Configuration().setDataSource(dataSource));
final var entity = database.getOrCreateEntity(MyFlatEntity.class);
final var ddl = entity.ddl();
// execute the statement on a Connection to create the table

final var entity = ...;
database.insert(entity);
final var found = database.findById(MyEntity.class, "myid");
database.update(entity);
database.delete(entity);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Mapping is a simple as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Table("MY_ENTITY")
public class MyEntity {
    @Id
    private String id;

    @Column // mark the field as persistent
    private String name;

    @Column(name = "SIMPLE_AGE") // rename the field
    private int age;

    @OnInsert
    private void onInsert() {
        id = MyIDFactory.create(); // any custom way to create an ID like an UUID (recommended)
    }

    @OnUpdate
    private void onUpdate() {
        // no-op
    }

    @OnDelete
    private void onDelete() {
        // no-op
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more advanced cases you can use <code>query</code> and <code>batch</code> methods from the <code>Database</code> instance.</p>
</div>
<div class="sect2">
<h3 id="_advanced_queries">Advanced queries</h3>
<div class="paragraph">
<p>For advanced queries you can use a virtual table (it is a plain table but the <code>@Table</code> annotation is ignored) which would be used as project based on query aliases:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">final var sql = "SELECT DISTINCT " + String.join(", ",
        entty1.concatenateColumns(new Entity.ColumnsConcatenationRequest()
                .setPrefix("e1.").setAliasPrefix("")),
        entity2.concatenateColumns(new Entity.ColumnsConcatenationRequest()
                .setPrefix("e2.").setAliasPrefix("e2").setIgnored(Set.of("e1_id")))) + " " +
        "FROM ENTITY1 e1" +
        " LEFT JOIN ENTITY2 admin on e2.e1_id = e1.id " +
        "WHERE e1.id = ?";
final var lines = final var lines = database.query(
        JoinModel.class, sql, b -&gt; b.bind("the-id"));</code></pre>
</div>
</div>
<div class="paragraph">
<p>with <code>JoinModel</code> being something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Table(name = "ignored")
public class JoinModel {
    // e1
    @Id
    private String id;
    @Column
    private String name;
    // e2
    @Id
    private String e2Id;
    @Column
    private String e2Label;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or you can also use <code>Entity</code> binder capacity:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">// can be done in a @PostConstruct
final var e2Alias = "e2";
final var e2Ignored = Set.of("e1Id");
final var sql = "SELECT DISTINCT " + String.join(", ",
        entty1.concatenateColumns(new Entity.ColumnsConcatenationRequest()
                .setPrefix("e1.").setAliasPrefix("")),
        entity2.concatenateColumns(new Entity.ColumnsConcatenationRequest()
                .setPrefix(e2Alias + '.').setAliasPrefix(e2Alias).setIgnored(e2Ignored))) + " " +
        "FROM ENTITY1 e1" +
        " LEFT JOIN ENTITY2 admin on e2.e1_id = e1.id " +
        "WHERE e1.id = ?";

// precompile the binders
var fields = database.getOrCreateEntity(Entity1.class).getOrderedColumns().stream()
            .map(Entity.ColumnMetadata::javaName)
            .collect(toList());
final var e1Binder = database.getOrCreateEntity(Entity1.class)
        .mapFromPrefix("", fields.toArray(String[]::new));

fields.addAll( // continue to go through the queries fields appending the next entity ones - binder will pick the column indices right this way
        database.getOrCreateEntity(Entity2.class)
            .getOrderedColumns().stream()
            .filter(c -&gt; !e2Ignored.contains(c.javaName()))
            .map(c -&gt; c.toAliasName(e2Alias))
            .collect(toList()));
final var e2Binder = database.getOrCreateEntity(Entity2.class)
        .mapFromPrefix(e2Alias, fields.toArray(String[]::new));

// at runtime
final var lines = final var lines = database.query(
        sql,
        b -&gt; b.bind("the-id"),
        result -&gt; {
            // bind current resultSet and iterate over each line of the resultSet
            return result.mapAll(line -&gt; Tuple2.of(e1Binder.apply(line), e2Binder.apply(line)));
        });
// lines will get both Entity1 and Entity2 instances, then you can just filter them checking there is an id or not for example
// and join them as needed to create your output model</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
1.0.2 was broken, ensure to use &gt;= 1.0.3 to get this feature.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_query_from_interfaces">Query from interfaces</h3>
<div class="paragraph">
<p>A light interface statement support is done through <code>@Operation</code> and <code>@Statement</code> annotations.
The idea is to expose the <code>Database</code> capabilities through a statically typed API.
Here is a sample:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Operation(aliases = @Operation.Alias(alias = "e", type = MyFlatEntity.class))
public interface MyOps {
    @Statement("select count(*) from ${e#table}")
    long countAll();

    @Statement("select ${e#fields} from ${e#table} order by name")
    List&lt;MyFlatEntity&gt; findAll();

    @Statement("select ${e#fields} from ${e#table} where name = ?")
    MyFlatEntity findOne(String name);

    @Statement("select ${e#fields} from ${e#table} where name = ${parameters#name}")
    MyFlatEntity findOneWithPlaceholders(String name);

    @Statement("delete from ${e#table} where name like ?")
    int delete(String name);

    @Statement("delete from ${e#table} where name like ?")
    void deleteWithoutReturnedValue(String name);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The statements can be plain SQL with <code>?</code> bindings or can use the available interpolations (but don&#8217;t mix <code>${parameters#xxx}</code> with <code>?</code> bindings, you must choose one type of binding per statement):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>${&lt;alias&gt;#table}</code>: name of the table of the entity aliased by <code>alias</code>,</p>
</li>
<li>
<p><code>${&lt;alias&gt;#fields}</code>: all columns of the entity represented by the alias,</p>
</li>
<li>
<p><code>${parameters#&lt;name&gt;}</code>: will be replaced by a <code>?</code> binding and the parameter named <code>name</code> (using bytecode name, ensure to compile with <code>-parameter</code> flag) will be used. It enables to not set the parameters in the same order than in the query because otherwise it is just bound blindly in order.</p>
</li>
<li>
<p><code>${parameters#&lt;name&gt;#in}</code>: will be replaced by as much <code>?</code> than the size of the parameter <code>name</code> and surround the bindings by parenthesis prefixed by <code>in ` keyword (ex: `in (?, ?)</code> if <code>name</code> parameter is a list of 2 items). It is useful for <code>in</code> where clauses.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Aliases are defined through <code>@Operation</code> annotation on the interface and enables to have a shorter syntax in the statement.
You can also use the fully qualified name of the entity instead of defining aliases but it is less readable.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_going_further">Going further</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is possible to enrich the JSON-RPC protocol, in particular bulk request support, by reusing <code>io.yupiik.uship.jsonrpc.core.impl.JsonRpcHandler</code> class in your own endpoints.
Typical examples are endpoint wrapping a set of request (sub methods), in a single transaction, endpoints propagating a state between method calls (like the second method will get the id generated in the first one), etc&#8230;&#8203;</p>
</div>
</div>
</div>
                
            </div>
        </div>
    <div class="page-navigation-right">
        <h3>Navigation</h3>
        <nav class="generated-nav-menu"></nav>
    </div>
    </div>
    <hr />
    <footer class="footer pb-5">
	    <div class="footer-bottom text-center">
		    <ul class="social-list list-unstyled">
                <li class="list-inline-item"><a href="https://www.github.com/yupiik/"><i class="fab fa-github fa-fw"></i></a></li><li class="list-inline-item"><a href="https://www.linkedin.com/company/yupiik/"><i class="fab fa-linkedin fa-fw"></i></a></li>
	        </ul>
            <small class="copyright">Yupiik &copy;</small> | <a href="https://www.yupiik.com/terms-of-service/">Terms of service</a> | <a href="https://www.yupiik.com/privacy-policy/">Privacy policy</a>
	    </div>
    </footer>

    <div class="modal fade" id="searchModal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="searchModalLabel">Search</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form onsubmit="return false;" class="form-inline">
          <div class="form-group">
            <label for="searchInput"><b>Search: </b></label>
            <input class="form-control" id="searchInput" placeholder="Enter search text and hit enter...">
          </div>
        </form>
        <div class="search-hits"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" ></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.3/js/bootstrap.min.js" integrity="sha512-8qmis31OQi6hIRgvkht0s6mCOittjMa9GMqtK9hes5iEQBQE/Ca6yGE5FsW36vyipGoWQswBj/QBm2JR086Rkw==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.1/highlight.min.js" integrity="sha512-d00ajEME7cZhepRqSIVsQVGDJBdZlfHyQLNC6tZXYKTG7iwcF8nhlFuppanz8hYgXr8VvlfKh4gLC25ud3c90A==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.1/languages/bash.min.js" integrity="sha512-Hg0ufGEvn0AuzKMU0psJ1iH238iUN6THh7EI0CfA0n1sd3yu6PYet4SaDMpgzN9L1yQHxfB3yc5ezw3PwolIfA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.1/languages/bash.min.js" integrity="sha512-Hg0ufGEvn0AuzKMU0psJ1iH238iUN6THh7EI0CfA0n1sd3yu6PYet4SaDMpgzN9L1yQHxfB3yc5ezw3PwolIfA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.1/languages/json.min.js" integrity="sha512-37sW1XqaJmseHAGNg4N4Y01u6g2do6LZL8tsziiL5CMXGy04Th65OXROw2jeDeXLo5+4Fsx7pmhEJJw77htBFg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.1/languages/dockerfile.min.js" integrity="sha512-eRNl3ty7GOJPBN53nxLgtSSj2rkYj5/W0Vg0MFQBw8xAoILeT6byOogENHHCRRvHil4pKQ/HbgeJ5DOwQK3SJA==" crossorigin="anonymous"></script>
    <script>if (!(window.minisite || {}).skipHighlightJs) { hljs.highlightAll(); }</script>
    <script src="//yupiik.github.io/uship/js/minisite.js?v=1.0.5-SNAPSHOT"></script>
    <script>$('.page-content-body').generatedNavMenu();</script>
    <script>
            document.querySelector('div.site-logo > a').href =
            document.location.pathname.indexOf('/uship') == 0 ? '/uship/index.html' : '/index.html';
            </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.3/fuse.min.js" integrity="sha512-neoBxVNv0UMXjoilAYGxfWrSsW6iAVclx7vQKdPJ9Peet1bM5YQjU0aIB8LtH8iNPa+pAyMZprBBw2ZQ/Q1LjQ==" crossorigin="anonymous"></script>

</body>
</html>
